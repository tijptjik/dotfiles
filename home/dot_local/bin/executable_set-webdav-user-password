#!/usr/bin/env fish
# Set a webdav user's password

function show_usage
    echo "Usage: set-webdav-user-password <username>"
    echo ""
    echo "Sets a new password for an existing WebDAV user."
    echo "You will be prompted to enter the password securely."
    exit 0
end

if test (count $argv) -eq 0
    show_usage
end

if contains -- $argv[1] -h --help
    show_usage
end

set USER $argv[1]

if not string match -qr '^[a-zA-Z0-9_-]+$' $USER
    echo "Invalid username"
    exit 1
end

if not sudo htpasswd /etc/nginx/.htpasswd $USER
    echo "Failed to set password."
    exit 1
end

echo "Password set for $USER."
